#!/bin/bash
set -x
ulimit -n 1024
PATH=$PATH:/usr/local/bin

duplicity \
  --s3-use-new-style \
  --allow-source-mismatch \
  --full-if-older-than 1M \
  --encrypt-key DFC1C9A1 \
  $HOME/.secrets \
  s3+http://marksteve/Secrets

restic \
  --repo rclone:marksteve_gcs:marksteve/secrets \
  backup $HOME/.secrets

tarsnap-backup() {
  tarsnap -v --humanize-numbers -c -f $(grealpath "$1"):$(date -u +%Y-%m-%d) $1
}
tarsnap-backup $HOME/.secrets
